// TOML parser implementation, v0.0.5
// Copyright (c)2013 alexander.beletsky@gmail.com
// Distributed under MIT license
// http://github.com/alexander.beletsky/toml.js
(function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd&&define(t)})(this,function(){var toml=function(){var parseGroup=function(e,t){function s(e){var t=e.indexOf("["),n=e.indexOf("]");return e.substring(t+1,n)}function o(e){return e.split(".")}function u(t,n){if(t[n])throw new Error('"'+n+'" is overriding existing value');var r=t[n]={};e.currentGroup=r}function a(e,t){t.reduce(function(t,n){return e[t]||u(e,t),u(e[t],n),n})}var n=e.result,r=s(t);if(r.indexOf(".")!==-1){var i=o(r);a(n,i)}else u(n,r)},parseExpression=function(context,line){function parseNameValue(e){var t=e.indexOf("=");return{name:e.substring(0,t),value:e.substring(t+1)}}function parseValue(e){function t(e){return e.charAt(0)==="["&&e.charAt(e.length-1)==="]"}return t(e)?parseArray(e):parsePrimitive(e)}function parseArray(e){function n(e){function i(e){var t=[],n=!1,r=0;for(var i=0;i<e.length;i++){var s=e[i];s==="["?r++:s==="]"&&r--,s===","&&r===0&&t.push(i)}return t.push(e.length),t}var t=[],n=e.substring(1,e.length-1),r=i(n);return r.reduce(function(e,r){return t.push(n.substring(e+1,r)),r},-1),t}var t=n(e);return t.map(function(e){return parseValue(e)})}function parsePrimitive(value){function date(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z/.test(e)}return date(value)?new Date(value):eval(value)}var pair=parseNameValue(line),value=parseValue(pair.value),currentGroup=context.currentGroup||context.result;currentGroup[pair.name]=value},parseLine=function(e,t){function n(e){return e.charAt(0)==="["}function r(e){return e.indexOf("=")>0}function i(e){return e===""}function s(){delete e.currentGroup}n(t)?parseGroup(e,t):r(t)?parseExpression(e,t):i(t)&&s()},parse=function(e,t){function n(e){return e.replace(/\s/g,"")}function r(e){return e.split("#")[0]}function i(e){function s(e){return e.indexOf("[")!==-1&&e.indexOf("]")===-1}function o(e){return e.indexOf("]")!==-1}var t=[],n=[],r=!1,i=!1;return e.forEach(function(e){s(e)&&(r=!0),r&&o(e)&&(i=!0),r?n.push(e):t.push(e),i&&(r=!1,i=!1,t.push(n.join("")),n=[])}),t}i(t).forEach(function(t){t=r(n(t)),parseLine(e,t)})},startParser=function(e){var t={};t.result={};var n=e.toString().split("\n");return parse(t,n),t.result};return{parse:startParser}}();return toml});